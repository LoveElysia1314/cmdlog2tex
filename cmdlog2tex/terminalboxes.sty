% ============================================================================
% terminalboxes.sty - Terminal Environment Package
% 
% 功能：为 LaTeX 文档提供统一的终端环境定义，支持有色/无色模式切换
% 
% 使用方法：
%   \usepackage{terminalboxes}
%
% 依赖包：
%   - xcolor
%   - tcolorbox (with option: most)
%   - listings
%
% 环境：
%   1. terminalcolored{标题}{dark/light} - 有色终端环境
%   2. terminalplain{标题}{dark/light} - 无色终端环境（推荐）
%
% ============================================================================

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{terminalboxes}[2025/10/25 v1.0 Terminal Environments Package]

% ============================================================================
% 依赖包声明
% ============================================================================

\RequirePackage{xcolor}
\RequirePackage[most]{tcolorbox}
\RequirePackage{listings}

% ============================================================================
% 颜色定义
% ============================================================================

% ----- 终端主题颜色 -----
\definecolor{terminalbg}{RGB}{40,44,52}       % 深色背景
\definecolor{terminalfg}{RGB}{171,178,191}    % 前景色
\definecolor{promptgreen}{RGB}{39,201,63}     % 提示符绿色
\definecolor{pathblue}{RGB}{80,150,255}       % 路径蓝色

% ----- ANSI 颜色定义（用于有色模式）-----
\definecolor{ansiblack}{RGB}{0,0,0}
\definecolor{ansired}{RGB}{205,49,49}
\definecolor{ansigreen}{RGB}{0,255,0}
\definecolor{ansiyellow}{RGB}{255,255,0}
\definecolor{ansiblue}{RGB}{0,0,255}
\definecolor{ansimagenta}{RGB}{255,0,255}
\definecolor{ansicyan}{RGB}{0,255,255}
\definecolor{ansiwhite}{RGB}{255,255,255}
\definecolor{ansigray}{RGB}{128,128,128}
\definecolor{lime}{RGB}{0,255,0}

% ============================================================================
% Listings 样式定义
% ============================================================================

% ----- 终端无色样式（用于 terminalplain 环境）-----
\lstdefinestyle{terminalplain}{%
  basicstyle=\ttfamily\small,
  breaklines=true,
  breakatwhitespace=false,
  breakautoindent=false,
  breakindent=0pt,
  numbers=none,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=4,
  frame=none,
  columns=fullflexible,
  keepspaces=true,
  upquote=true,
  literate={~}{{\textasciitilde}}1
           {\^}{{\textasciicircum}}1
           {\$}{{\textdollar}}1
           {\#}{{\#}}1
           {\\}{{\textbackslash}}1%
}

% ============================================================================
% tcbset 样式预设
% ============================================================================

\tcbset{%
  % ----- 深色主题 -----
  base dark/.style={%
    colback=terminalbg,
    colframe=gray,
    coltext=terminalfg,
    coltitle=white,
    colbacktitle=black,
  },
  %
  % ----- 浅色主题 -----
  base light/.style={%
    colback=white,
    colframe=gray,
    coltext=black,
    coltitle=black,
    colbacktitle=gray!20,
  },
  %
  % ----- 通用样式 -----
  base common/.style={%
    enhanced jigsaw,
    breakable,
    boxrule=0.5pt,
    arc=3pt,
    left=8pt,
    right=8pt,
    top=8pt,
    bottom=8pt,
    fonttitle=\ttfamily\small\bfseries,
    before skip=10pt,
    after skip=10pt,
    width=\textwidth,
  }%
}

% ============================================================================
% 环境定义
% ============================================================================

% ----- 有色终端环境 -----
% 用法：\begin{terminalcolored}{标题}{dark/light} ... \end{terminalcolored}
%
% 参数：
%   #1 - 标题（显示在盒子顶部）
%   #2 - 主题选择：dark（深色）或 light（浅色）
%
% 说明：
%   需要手动添加颜色命令，例如：
%   \textcolor{ansigreen}{max@qmobile} 
%
\newtcolorbox{terminalcolored}[2]{%
  base common,
  base #2,
  fontupper=\ttfamily\small,
  title=#1,
  title after break=#1,
}

% ----- 无色终端环境（基于 listings）-----
% 用法：\begin{terminalplain}{标题}{dark/light} ... \end{terminalplain}
%
% 参数：
%   #1 - 标题（显示在盒子顶部）
%   #2 - 主题选择：dark（深色）或 light（浅色）
%
% 说明：
%   推荐使用此环境，自动处理特殊字符（$, #, \, ^, ~ 等）
%   无需手动转义
%
\newtcblisting{terminalplain}[2]{%
  base common,
  base #2,
  listing engine=listings,
  listing only,
  listing options={style=terminalplain,basicstyle=\ttfamily\small},
  title=#1,
  title after break=#1,
}

% ============================================================================
% 宏包信息
% ============================================================================
%
% 快速开始示例：
%
% \documentclass{article}
% \usepackage[utf8]{inputenc}
% \usepackage{xcolor}
% \usepackage{terminalboxes}
%
% \begin{document}
%
% % 无色模式（推荐）
% \begin{terminalplain}{Terminal}{dark}
% $ ls -la
% $ pwd
% \end{terminalplain}
%
% % 有色模式
% \begin{terminalcolored}{Terminal}{dark}
% \textcolor{promptgreen}{\$} ls -la \\
% \end{terminalcolored}
%
% \end{document}
%
% ============================================================================

\endinput